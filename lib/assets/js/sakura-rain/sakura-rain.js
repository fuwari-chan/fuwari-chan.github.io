const isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);class Sakura{constructor(t,e){this.active=!1,this.img=t,this.direction=e,this.x=0,this.y=0,this.s=0,this.r=0,this.xSpeed=0,this.ySpeed=0,this.rSpeed=0,this.scale=0}init(){this.active=!0;let t=Math.random()>.5;const e={TopRight:()=>{this.x=t?getRandom("x"):window.innerWidth,this.y=t?0:getRandom("y"),this.xSpeed=-Math.abs(getRandom("fnx")),this.ySpeed=Math.abs(getRandom("fny"))},TopLeft:()=>{this.x=t?getRandom("x"):0,this.y=t?0:getRandom("y"),this.xSpeed=Math.abs(getRandom("fnx")),this.ySpeed=Math.abs(getRandom("fny"))},BottomRight:()=>{this.x=t?getRandom("x"):window.innerWidth,this.y=t?window.innerHeight:getRandom("y"),this.xSpeed=-Math.abs(getRandom("fnx")),this.ySpeed=-Math.abs(getRandom("fny"))},BottomLeft:()=>{this.x=t?getRandom("x"):0,this.y=t?window.innerHeight:getRandom("y"),this.xSpeed=Math.abs(getRandom("fnx")),this.ySpeed=-Math.abs(getRandom("fny"))}};(this.direction in e?e[this.direction]:e.TopRight)(),this.s=getRandom("s"),this.r=getRandom("r"),this.rSpeed=getRandom("fnr"),this.scale=.4*Math.random()+.6}update(){this.x+=this.xSpeed,this.y+=this.ySpeed,this.r+=this.rSpeed,(this.x>window.innerWidth||this.x<0||this.y>window.innerHeight||this.y<0)&&(this.active=!1)}draw(t){const e=30*this.s*this.scale;t.save(),t.translate(this.x,this.y),t.rotate(this.r),t.drawImage(this.img,0,0,e,e),t.restore()}}class SakuraPool{constructor(t,e,i){this.pool=[],this.img=e,this.direction=i,this.init(t)}init(t){for(let e=0;e<t;e++)this.pool.push(new Sakura(this.img,this.direction))}get(){let t=this.pool.length>0?this.pool.shift():new Sakura(this.img,this.direction);return t.init(),t}recycle(t){t.active=!1,this.pool.push(t)}}class SakuraList{constructor(t){this.list=[],this.pool=t}push(t){this.list.push(t)}update(){for(let t=0;t<this.list.length;t++){const e=this.list[t];e.active?e.update():(this.pool.recycle(e),this.list.splice(t,1),t--)}}draw(t){this.list.forEach((e=>e.draw(t)))}}function startSakura(t,e,i){const a=new Image;a.src="/lib/assets/js/sakura-rain/sakura.png";const n=document.createElement("canvas"),s=n.getContext("2d");isMobile&&(t=Math.floor(.5*t));const o=new SakuraPool(t,a,e),r=new SakuraList(o);setupCanvas(n,i),a.onload=()=>{initializeSakura(r,t),requestAnimationFrame((()=>animate(s,r,n,t)))},a.onerror=()=>{console.error("Failed to load sakura image")},window.onresize=()=>resizeCanvas(n)}function setupCanvas(t,e){resizeCanvas(t),Object.assign(t.style,{position:"fixed",left:"0",top:"0",pointerEvents:"none",zIndex:e.toString()}),t.id="canvas_sakura",document.getElementById("canvas_sakura")||document.body.appendChild(t)}function resizeCanvas(t){t.width=window.innerWidth,t.height=window.innerHeight}function initializeSakura(t,e){for(let i=0;i<e;i++){const e=t.pool.get();e.init(),t.push(e)}}function animate(t,e,i,a){for(t.clearRect(0,0,i.width,i.height),e.update(),e.draw(t);e.list.length<a;){const t=e.pool.get();t.init(),e.push(t)}requestAnimationFrame((()=>animate(t,e,i,a)))}function getRandom(t){const e={x:()=>Math.random()*window.innerWidth,y:()=>Math.random()*window.innerHeight,s:()=>Math.random(),r:()=>6*Math.random(),fnx:()=>-Math.random()*xSpeed,fny:()=>Math.random()*ySpeed,fnr:()=>Math.random()*rSpeed,default:()=>0};return(e[t]||e.default)()}function useDefault(t,e){return void 0!==t?t:e}const config=window.sakuraConfig||{},maxSakura=useDefault(parseInt(config.sakura),30),xSpeed=useDefault(parseFloat(config.xSpeed),.5),ySpeed=useDefault(parseFloat(config.ySpeed),.5),rSpeed=useDefault(parseFloat(config.rSpeed),.025),direction=useDefault(config.direction,"TopRight"),zIndex=useDefault(parseInt(config.zIndex),-1);startSakura(maxSakura,direction,zIndex);